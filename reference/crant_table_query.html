<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Read and write to the seatable for draft CRANT annotations — crant_table_query • crantr</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Read and write to the seatable for draft CRANT annotations — crant_table_query"><meta name="description" content="These functions use the logic and wrap some code
from the flytable_.* functions in the fafbseg R package.
crant_table_set_token will obtain and store a permanent
seatable user-level API token.
crant_table_query performs a SQL query against a crant_table
database. You can omit the base argument unless you have tables of
the same name in different bases.
crant_table_base returns a base object (equivalent to
a mysql database) which allows you to access one or more tables, logging in
to the service if necessary. The returned base object give you full access
to the Python
Base
API allowing a range of row/column manipulations.
crant_table_update_rows updates existing rows in a table, returning TRUE on success."><meta property="og:description" content="These functions use the logic and wrap some code
from the flytable_.* functions in the fafbseg R package.
crant_table_set_token will obtain and store a permanent
seatable user-level API token.
crant_table_query performs a SQL query against a crant_table
database. You can omit the base argument unless you have tables of
the same name in different bases.
crant_table_base returns a base object (equivalent to
a mysql database) which allows you to access one or more tables, logging in
to the service if necessary. The returned base object give you full access
to the Python
Base
API allowing a range of row/column manipulations.
crant_table_update_rows updates existing rows in a table, returning TRUE on success."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">crantr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../index.html" aria-label="Home"><span class="fa fas fa-home fa-lg"></span></a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
<li class="nav-item"><a class="nav-link" href="../SUPPORT.html">Help</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><a class="external-link nav-link" href="https://natverse.github.io">natverse</a></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/flyconnectome/crantr/"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Read and write to the seatable for draft CRANT annotations</h1>
      <small class="dont-index">Source: <a href="https://github.com/flyconnectome/crantr/blob/main/R/ant-table.R" class="external-link"><code>R/ant-table.R</code></a></small>
      <div class="d-none name"><code>crant_table_query.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>These functions use the logic and wrap some code
from the <code>flytable_.*</code> functions in the <code>fafbseg</code> R package.
<code>crant_table_set_token</code> will obtain and store a permanent
seatable user-level API token.
<code>crant_table_query</code> performs a SQL query against a crant_table
database. You can omit the <code>base</code> argument unless you have tables of
the same name in different bases.
<code>crant_table_base</code> returns a <code>base</code> object (equivalent to
a mysql database) which allows you to access one or more tables, logging in
to the service if necessary. The returned base object give you full access
to the Python
<a href="https://seatable.github.io/seatable-scripts/python/base/" class="external-link"><code>Base</code></a>
API allowing a range of row/column manipulations.
<code>crant_table_update_rows</code> updates existing rows in a table, returning TRUE on success.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">crant_table_query</span><span class="op">(</span></span>
<span>  sql <span class="op">=</span> <span class="st">"SELECT * FROM CRANTb_meta"</span>,</span>
<span>  limit <span class="op">=</span> <span class="fl">200000L</span>,</span>
<span>  base <span class="op">=</span> <span class="st">"CRANTb"</span>,</span>
<span>  python <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  convert <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  ac <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  workspace_id <span class="op">=</span> <span class="st">"62919"</span>,</span>
<span>  token_name <span class="op">=</span> <span class="st">"CRANTTABLE_TOKEN"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">crant_table_set_token</span><span class="op">(</span></span>
<span>  <span class="va">user</span>,</span>
<span>  <span class="va">pwd</span>,</span>
<span>  url <span class="op">=</span> <span class="st">"https://cloud.seatable.io/"</span>,</span>
<span>  token_name <span class="op">=</span> <span class="st">"CRANTTABLE_TOKEN"</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">crant_table_login</span><span class="op">(</span></span>
<span>  url <span class="op">=</span> <span class="st">"https://cloud.seatable.io/"</span>,</span>
<span>  token <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Sys.getenv.html" class="external-link">Sys.getenv</a></span><span class="op">(</span><span class="st">"CRANTTABLE_TOKEN"</span>, unset <span class="op">=</span> <span class="cn">NA_character_</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">crant_table_update_rows</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  table <span class="op">=</span> <span class="st">"CRANTb_meta"</span>,</span>
<span>  base <span class="op">=</span> <span class="st">"CRANTb"</span>,</span>
<span>  append_allowed <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  chunksize <span class="op">=</span> <span class="fl">1000L</span>,</span>
<span>  workspace_id <span class="op">=</span> <span class="st">"62919"</span>,</span>
<span>  token_name <span class="op">=</span> <span class="st">"CRANTTABLE_TOKEN"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">crant_table_append_rows</span><span class="op">(</span></span>
<span>  <span class="va">df</span>,</span>
<span>  <span class="va">table</span>,</span>
<span>  base <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  chunksize <span class="op">=</span> <span class="fl">1000L</span>,</span>
<span>  token_name <span class="op">=</span> <span class="st">"CRANTTABLE_TOKEN"</span>,</span>
<span>  workspace_id <span class="op">=</span> <span class="st">"62919"</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">crant_table_updateids</span><span class="op">(</span>table <span class="op">=</span> <span class="st">"CRANTb_meta"</span>, base <span class="op">=</span> <span class="st">"CRANTb"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">crant_table_annotate</span><span class="op">(</span></span>
<span>  <span class="va">root_ids</span>,</span>
<span>  <span class="va">update</span>,</span>
<span>  overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  append <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  column <span class="op">=</span> <span class="st">"notes"</span>,</span>
<span>  table <span class="op">=</span> <span class="st">"CRANTb_meta"</span>,</span>
<span>  base <span class="op">=</span> <span class="st">"CRANTb"</span>,</span>
<span>  workspace_id <span class="op">=</span> <span class="st">"62919"</span>,</span>
<span>  token_name <span class="op">=</span> <span class="st">"CRANTTABLE_TOKEN"</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-sql">sql<a class="anchor" aria-label="anchor" href="#arg-sql"></a></dt>
<dd><p>A SQL query string. See examples and
<a href="https://seatable.github.io/seatable-scripts/python/query/" class="external-link">seatable
docs</a>.</p></dd>


<dt id="arg-limit">limit<a class="anchor" aria-label="anchor" href="#arg-limit"></a></dt>
<dd><p>An optional limit, which only applies if you do not specify a
limit directly in the <code>sql</code> query. By default seatable limits SQL
queries to 100 rows. We increase the limit to 100000 rows by default.</p></dd>


<dt id="arg-base">base<a class="anchor" aria-label="anchor" href="#arg-base"></a></dt>
<dd><p>Character vector specifying the <code>base</code></p></dd>


<dt id="arg-python">python<a class="anchor" aria-label="anchor" href="#arg-python"></a></dt>
<dd><p>Logical. Whether to return a Python pandas DataFrame. The default of FALSE returns an R data.frame</p></dd>


<dt id="arg-convert">convert<a class="anchor" aria-label="anchor" href="#arg-convert"></a></dt>
<dd><p>Expert use only: Whether or not to allow the Python seatable
module to process raw output from the database. This is is principally for
debugging purposes. NB this imposes a requirement of seatable_api &gt;=2.4.0.</p></dd>


<dt id="arg-ac">ac<a class="anchor" aria-label="anchor" href="#arg-ac"></a></dt>
<dd><p>A seatable connection object as returned by <code>crant_table_login</code>.</p></dd>


<dt id="arg-workspace-id">workspace_id<a class="anchor" aria-label="anchor" href="#arg-workspace-id"></a></dt>
<dd><p>A numeric id specifying the workspace. Advanced use only</p></dd>


<dt id="arg-token-name">token_name<a class="anchor" aria-label="anchor" href="#arg-token-name"></a></dt>
<dd><p>The name of the token in your .Renviron file, should be <code>CRANTTABLE_TOKEN</code>.</p></dd>


<dt id="arg-user-pwd">user, pwd<a class="anchor" aria-label="anchor" href="#arg-user-pwd"></a></dt>
<dd><p>crant_table user and password used by <code>crant_table_set_token</code>
to obtain a token</p></dd>


<dt id="arg-url">url<a class="anchor" aria-label="anchor" href="#arg-url"></a></dt>
<dd><p>Optional URL to the server</p></dd>


<dt id="arg-token">token<a class="anchor" aria-label="anchor" href="#arg-token"></a></dt>
<dd><p>normally retrieved from <code>CRANTTABLE_TOKEN</code> environment
variable.</p></dd>


<dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>A data.frame containing the data to upload including an <code>_id</code>
column that can identify each row in the remote table.</p></dd>


<dt id="arg-table">table<a class="anchor" aria-label="anchor" href="#arg-table"></a></dt>
<dd><p>Character vector specifying a table foe which you want a
<code>base</code> object.</p></dd>


<dt id="arg-append-allowed">append_allowed<a class="anchor" aria-label="anchor" href="#arg-append-allowed"></a></dt>
<dd><p>Logical. Whether rows without row identifiers can be appended.</p></dd>


<dt id="arg-chunksize">chunksize<a class="anchor" aria-label="anchor" href="#arg-chunksize"></a></dt>
<dd><p>To split large requests into smaller ones with max this many rows.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>additional arguments passed to pbsapply which might include cl=2 to specify a number of parallel jobs to run.</p></dd>


<dt id="arg-root-ids">root_ids<a class="anchor" aria-label="anchor" href="#arg-root-ids"></a></dt>
<dd><p>the CRANTb root ids to update, must be present in the seatable.</p></dd>


<dt id="arg-update">update<a class="anchor" aria-label="anchor" href="#arg-update"></a></dt>
<dd><p>the replacement entries you want in the chosen <code>column</code> for the given <code>root_ids</code>.</p></dd>


<dt id="arg-overwrite">overwrite<a class="anchor" aria-label="anchor" href="#arg-overwrite"></a></dt>
<dd><p>whether or to overwrite entries in the chosen <code>column</code> for the given <code>root_ids</code>.</p></dd>


<dt id="arg-append">append<a class="anchor" aria-label="anchor" href="#arg-append"></a></dt>
<dd><p>if <code>overwrite==FALSE</code>, then whether or to append (separated by a <code>,</code>) entries in the chosen <code>column</code> for the given <code>root_ids</code>.</p></dd>


<dt id="arg-column">column<a class="anchor" aria-label="anchor" href="#arg-column"></a></dt>
<dd><p>the column in the seatable to update for the given <code>root_ids</code>.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a <code>data.frame</code> of results. There should be 0 rows if no rows
matched query.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code>fafbseg::<a href="https://rdrr.io/pkg/fafbseg/man/flytable-queries.html" class="external-link">flytable_query</a></code></p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Do this once</span></span></span>
<span class="r-in"><span><span class="fu">crant_table_set_token</span><span class="op">(</span>user<span class="op">=</span><span class="st">"MY_EMAIL_FOR_SEATABLE.com"</span>,</span></span>
<span class="r-in"><span>                    pwd<span class="op">=</span><span class="st">"MY_SEATABLE_PASSWORD"</span>,</span></span>
<span class="r-in"><span>                    url<span class="op">=</span><span class="st">"https://cloud.seatable.io/"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Thereafter:</span></span></span>
<span class="r-in"><span><span class="va">crant.meta</span> <span class="op">&lt;-</span> <span class="fu">crant_table_query</span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># A simple way to add annotations to specific neurons in the table quickly</span></span></span>
<span class="r-in"><span><span class="co"># this is just for one entry type for one chosen column</span></span></span>
<span class="r-in"><span><span class="fu">crant_table_annotate</span><span class="op">(</span>root_ids <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"576460752667713229"</span>,</span></span>
<span class="r-in"><span>                              <span class="st">"576460752662519193"</span>,</span></span>
<span class="r-in"><span>                              <span class="st">"576460752730083020"</span>,</span></span>
<span class="r-in"><span>                              <span class="st">"576460752673660716"</span>,</span></span>
<span class="r-in"><span>                              <span class="st">"576460752662521753"</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>                 update <span class="op">=</span> <span class="st">"lindsey_lopes"</span>,</span></span>
<span class="r-in"><span>                 overwrite <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                 append <span class="op">=</span> <span class="cn">FALSE</span>,</span></span>
<span class="r-in"><span>                 column <span class="op">=</span> <span class="st">"user_annotator"</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Alexander Bates.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer></div>





  </body></html>

